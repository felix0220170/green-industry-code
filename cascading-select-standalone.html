<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>四层下拉框联动展示</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 100%;
            margin: 50px auto;
            padding: 0 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        #step2 .container {
            max-width: 100%;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .container {
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .select-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            background-color: white;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f4f8;
            border-left: 4px solid #2196F3;
            border-radius: 4px;
        }
        .result h3 {
            margin-top: 0;
            color: #1976D2;
        }
        .result p {
            margin: 5px 0;
            color: #333;
        }
        
        /* 向导步骤样式 */
        .wizard-steps {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 40px;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        
        .step::after {
            content: '';
            position: absolute;
            top: 15px;
            left: 40px;
            width: 40px;
            height: 2px;
            background-color: #ddd;
            z-index: 1;
        }
        
        .step:last-child::after {
            display: none;
        }
        
        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #ddd;
            color: #666;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            margin-bottom: 5px;
            z-index: 2;
        }
        
        .step-title {
            font-size: 14px;
            color: #666;
        }
        
        .step.active .step-number {
            background-color: #2196F3;
            color: white;
        }
        
        .step.active .step-title {
            color: #2196F3;
            font-weight: bold;
        }
        
        .step.completed .step-number {
            background-color: #4CAF50;
            color: white;
        }
        
        .step.completed .step-title {
            color: #4CAF50;
        }
        
        /* 向导步骤内容样式 */
        .wizard-step {
            display: none;
        }
        
        .wizard-step.active {
            display: block;
        }
        
        /* 方法选择样式 */
        .method-choice {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .choice-option {
            flex: 1;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: white;
        }
        
        .choice-option h3 {
            margin-top: 0;
            color: #333;
            font-size: 16px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        /* 输入组样式 */
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group input {
            width: calc(100% - 120px);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            margin-right: 10px;
        }
        
        .input-group button {
            padding: 12px 20px;
            background-color: #4CAF50 !important;
            color: white !important;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        .input-group button:hover {
            background-color: #45a049;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            transform: translateY(-1px);
        }
        
        .input-group button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* 验证消息样式 */
        .validation-message {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        /* 备注样式 */
        .note {
            margin-top: 15px;
            padding: 12px;
            background-color: #e8f5e8;
            border-left: 4px solid #4CAF50;
            border-radius: 4px;
            font-size: 14px;
            color: #333;
        }
        
        .note p {
            margin: 0;
        }
        
        /* 高亮样式 */
        .highlight {
            background-color: #ffff00;
            color: #000000;
            font-weight: bold;
            padding: 2px 4px;
            border-radius: 2px;
        }
        
        .validation-message.valid {
            background-color: #e8f5e9;
            color: #4CAF50;
            border-left: 4px solid #4CAF50;
        }
        
        .validation-message.invalid {
            background-color: #ffebee;
            color: #f44336;
            border-left: 4px solid #f44336;
        }
        
        /* 步骤导航样式 */
        .step-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .step-navigation button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }
        
        .step-navigation button:disabled {
            background-color: #ddd;
            color: #666;
            cursor: not-allowed;
        }
        
        #step1-next, #step2-next, #submit-application {
            background-color: #4CAF50;
            color: white;
        }
        
        #step1-next:hover:not(:disabled), #step2-next:hover:not(:disabled), #submit-application:hover:not(:disabled) {
            background-color: #45a049;
        }
        
        button:not(#step1-next):not(#step2-next):not(#submit-application) {
            background-color: #f1f1f1;
            color: #333;
        }
        
        button:not(#step1-next):not(#step2-next):not(#submit-application):hover {
            background-color: #ddd;
        }
        
        /* 表格样式 */
        .result-table {
            width: 100%;
            min-width: 1000px;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 13px;
        }
        
        /* 表格容器样式 */
        .table-container {
            overflow-x: auto;
            max-width: 100%;
        }
        
        .result-table thead {
            background-color: #f2f2f2;
            position: sticky;
            top: 0;
        }
        
        .result-table th, .result-table td {
            padding: 8px 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            white-space: normal;
            word-wrap: break-word;
            max-width: 300px;
        }
        
        .result-table th {
            font-weight: bold;
            color: #333;
            font-size: 15px;
        }
        
        .result-table tr:hover {
            background-color: #f5f5f5;
        }
        
        /* 调整表格所在容器 */
        #step2 .container {
            max-width: 100%;
            padding: 0 20px;
        }
        
        #matching-result {
            overflow-x: auto;
        }
        
        /* 复选框样式 */
        .select-checkbox {
            width: 20px;
            height: 20px;
        }
        
        /* 温室气体减排贡献样式 */
        .ghg-contribution {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .ghg-contribution.high {
            background-color: #e8f5e9;
            color: #4CAF50;
        }
        
        .ghg-contribution.medium {
            background-color: #fff3e0;
            color: #ff9800;
        }
        
        .ghg-contribution.low {
            background-color: #f5f5f5;
            color: #9e9e9e;
        }
        
        /* 上传区域样式 */
        .upload-section {
            margin: 20px 0;
        }
        
        .upload-item {
            margin-bottom: 20px;
        }
        
        .upload-item label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        .upload-item input[type="file"] {
            margin-bottom: 10px;
        }
        
        .file-info {
            font-size: 14px;
            color: #666;
            padding: 5px 0;
        }
        
        .upload-item textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            resize: vertical;
        }
        
        /* 最终结果样式 */
        .final-result {
            text-align: center;
            padding: 40px 20px;
            background-color: #f5f5f5;
            border-radius: 8px;
            margin: 30px 0;
        }
        
        .final-result h3 {
            color: #333;
            margin-bottom: 20px;
        }
        
        .final-result .status {
            font-size: 20px;
            font-weight: bold;
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
        }
        
        .status.eligible {
            background-color: #e8f5e9;
            color: #4CAF50;
        }
        
        .status.not-eligible {
            background-color: #ffebee;
            color: #f44336;
        }
        
        .status.pending {
            background-color: #fff3e0;
            color: #ff9800;
        }
    </style>
</head>
<body>
    <h1>国民经济行业分类四层下拉框联动</h1>
    <!-- 向导步骤指示器 -->
    <div class="wizard-steps">
        <div class="step active" id="step1-indicator">
            <div class="step-number">1</div>
            <div class="step-title">选择行业代码</div>
        </div>
        <div class="step" id="step2-indicator">
            <div class="step-number">2</div>
            <div class="step-title">匹配支持项目</div>
        </div>
        <div class="step" id="step3-indicator">
            <div class="step-number">3</div>
            <div class="step-title">上传证明材料</div>
        </div>
    </div>

    <div class="container">
        <!-- 第一步：选择行业代码 -->
        <div id="step1" class="wizard-step active">
            <h2>第一步：选择国民经济行业代码</h2>
            <div class="method-choice">
                <div class="choice-option">
                    <h3>方式一：通过下拉菜单选择</h3>
                    <div class="select-group">
                        <label for="level1">1. 门类：</label>
                        <select id="level1" onchange="onLevel1Change()">
                            <option value="">请选择门类</option>
                        </select>
                    </div>
                    
                    <div class="select-group">
                        <label for="level2">2. 大类：</label>
                        <select id="level2" onchange="onLevel2Change()">
                            <option value="">请先选择门类</option>
                        </select>
                    </div>
                    
                    <div class="select-group">
                        <label for="level3">3. 中类：</label>
                        <select id="level3" onchange="onLevel3Change()">
                            <option value="">请先选择大类</option>
                        </select>
                    </div>
                    
                    <div class="select-group">
                        <label for="level4">4. 小类：</label>
                        <select id="level4" onchange="onLevel4Change()">
                            <option value="">请先选择中类</option>
                        </select>
                    </div>
                </div>
                
                <div class="choice-option">
                    <h3>方式二：直接输入4位行业代码</h3>
                    <div class="input-group">
                        <label for="industryCode">行业代码：</label>
                        <input type="text" id="industryCode" placeholder="请输入4位数字" maxlength="4">
                        <button onclick="validateIndustryCode()" id="validateBtn">验证代码</button>
                        <div id="codeValidation" class="validation-message"></div>
                    </div>
                    <div class="note">
                        <p>备注：9610（社区居民自治组织）是一个有效的行业代码，但不会命中任何绿色金融支持项目记录，可用于测试未命中场景。</p>
                    </div>
                </div>
            </div>
            
            <div class="step-navigation">
                <button id="step1-next" onclick="proceedToStep2()" disabled>下一步</button>
            </div>
        </div>
        
        <!-- 第二步：匹配支持项目 -->
        <div id="step2" class="wizard-step">
            <h2>第二步：匹配绿色金融支持项目</h2>
            <div id="matching-result">
                <p>正在匹配，请稍候...</p>
            </div>
            
            <div class="step-navigation">
                <button onclick="backToStep1()">上一步</button>
                <button id="step2-next" onclick="proceedToStep3()" disabled>下一步</button>
                <button id="declare-not-eligible" onclick="declareNotEligible()">我不符合任何条件</button>
            </div>
        </div>
        
        <!-- 第三步：上传证明材料 -->
        <div id="step3" class="wizard-step">
            <h2>第三步：上传证明材料</h2>
            <div id="selected-category-info">
                <p>请选择一个匹配的项目后再上传材料</p>
            </div>
            
            <div class="upload-section">
                <h3>上传证明材料</h3>
                <div class="upload-item">
                    <label for="proof-file">证明文件：</label>
                    <input type="file" id="proof-file" accept=".pdf,.doc,.docx,.jpg,.png">
                    <div class="file-info" id="file-info">未选择文件</div>
                </div>
                
                <div class="upload-item">
                    <label for="description">说明：</label>
                    <textarea id="description" rows="4" placeholder="请简要说明您如何符合该项目的条件"></textarea>
                </div>
            </div>
            
            <div class="step-navigation">
                <button onclick="backToStep2()">上一步</button>
                <button id="submit-application" onclick="submitApplication()">提交审核</button>
            </div>
        </div>
        
        <!-- 结果页面 -->
        <div id="result-page" class="wizard-step">
            <h2>审核结果</h2>
            <div id="final-result">
                <p>正在生成结果...</p>
            </div>
        </div>
    </div>
    <script src="data/code_data.js"></script>
    <script src="data/project_data.js"></script>
    <script>        
        // 行业代码目录的json data
        let jsonData = industry_code_data;
        
        // 绿色金融支持项目目录的json data
        let greenFinanceData = green_support_finance_data;

        let currentSelections = {
            level1: null,
            level2: null,
            level3: null,
            level4: null
        };

        // 全局变量
        let currentIndustryCode = null;
        let currentIndustryName = null;
        let matchedItems = [];
        let selectedCategory = null;
        
        // 页面加载完成后初始化第一级选择
        window.onload = function() {
            populateLevel1();
            // 监听行业代码输入框的变化
            document.getElementById('industryCode').addEventListener('input', function() {
                // 验证输入是否为4位数字
                const input = this.value;
                const validationDiv = document.getElementById('codeValidation');
                if (input.length === 4 && /^\d+$/.test(input)) {
                    validationDiv.innerHTML = '';
                } else if (input.length > 0) {
                    validationDiv.innerHTML = '请输入4位数字的行业代码';
                    validationDiv.className = 'validation-message invalid';
                } else {
                    validationDiv.innerHTML = '';
                }
            });
            
            // 监听文件上传变化
            document.getElementById('proof-file').addEventListener('change', function() {
                const fileInfo = document.getElementById('file-info');
                if (this.files.length > 0) {
                    fileInfo.textContent = '已选择：' + this.files[0].name;
                } else {
                    fileInfo.textContent = '未选择文件';
                }
            });
        };

        // 填充第一级（门类）
        function populateLevel1() {
            const select = document.getElementById('level1');
            select.innerHTML = '<option value="">请选择门类</option>';
            
            jsonData.forEach(item => {
                const option = document.createElement('option');
                option.value = item.code;
                option.textContent = item.code + ' ' + item.name;
                select.appendChild(option);
            });
        }

        // 填充第二级（大类）
        function populateLevel2(level1Code) {
            const select = document.getElementById('level2');
            select.innerHTML = '<option value="">请选择大类</option>';
            
            const level1Item = jsonData.find(item => item.code === level1Code);
            if (level1Item && level1Item.children) {
                level1Item.children.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.code;
                    option.textContent = item.code + ' ' + item.name;
                    select.appendChild(option);
                });
            }
        }

        // 填充第三级（中类）
        function populateLevel3(level1Code, level2Code) {
            const select = document.getElementById('level3');
            select.innerHTML = '<option value="">请选择中类</option>';
            
            const level1Item = jsonData.find(item => item.code === level1Code);
            if (level1Item && level1Item.children) {
                const level2Item = level1Item.children.find(item => item.code === level2Code);
                if (level2Item && level2Item.children) {
                    level2Item.children.forEach(item => {
                        const option = document.createElement('option');
                        option.value = item.code;
                        option.textContent = item.code + ' ' + item.name;
                        select.appendChild(option);
                    });
                }
            }
        }

        // 填充第四级（小类）
        function populateLevel4(level1Code, level2Code, level3Code) {
            const select = document.getElementById('level4');
            select.innerHTML = '<option value="">请选择小类</option>';
            
            const level1Item = jsonData.find(item => item.code === level1Code);
            if (level1Item && level1Item.children) {
                const level2Item = level1Item.children.find(item => item.code === level2Code);
                if (level2Item && level2Item.children) {
                    const level3Item = level2Item.children.find(item => item.code === level3Code);
                    if (level3Item && level3Item.children) {
                        level3Item.children.forEach(item => {
                            const option = document.createElement('option');
                            option.value = item.code;
                            option.textContent = item.code + ' ' + item.name;
                            select.appendChild(option);
                        });
                    }
                }
            }
        }

        // 第一级选择变化
        function onLevel1Change() {
            const level1Code = document.getElementById('level1').value;
            currentSelections.level1 = level1Code;
            
            // 重置后续选择
            currentSelections.level2 = null;
            currentSelections.level3 = null;
            currentSelections.level4 = null;
            
            // 清空并重新填充第二级
            document.getElementById('level2').innerHTML = '<option value="">请选择大类</option>';
            document.getElementById('level3').innerHTML = '<option value="">请先选择大类</option>';
            document.getElementById('level4').innerHTML = '<option value="">请先选择中类</option>';
            
            if (level1Code) {
                populateLevel2(level1Code);
            }
            
            updateIndustryCode();
        }

        // 第二级选择变化
        function onLevel2Change() {
            const level1Code = currentSelections.level1;
            const level2Code = document.getElementById('level2').value;
            currentSelections.level2 = level2Code;
            
            // 重置后续选择
            currentSelections.level3 = null;
            currentSelections.level4 = null;
            
            // 清空并重新填充第三级
            document.getElementById('level3').innerHTML = '<option value="">请选择中类</option>';
            document.getElementById('level4').innerHTML = '<option value="">请先选择中类</option>';
            
            if (level1Code && level2Code) {
                populateLevel3(level1Code, level2Code);
            }
            
            updateIndustryCode();
        }

        // 第三级选择变化
        function onLevel3Change() {
            const level1Code = currentSelections.level1;
            const level2Code = currentSelections.level2;
            const level3Code = document.getElementById('level3').value;
            currentSelections.level3 = level3Code;
            
            // 重置后续选择
            currentSelections.level4 = null;
            
            // 清空并重新填充第四级
            document.getElementById('level4').innerHTML = '<option value="">请选择小类</option>';
            
            if (level1Code && level2Code && level3Code) {
                populateLevel4(level1Code, level2Code, level3Code);
            }
            
            updateIndustryCode();
        }

        // 第四级选择变化
        function onLevel4Change() {
            currentSelections.level4 = document.getElementById('level4').value;
            updateIndustryCode();
        }

        // 更新当前选中的行业代码
        function updateIndustryCode() {
            const { level1, level2, level3, level4 } = currentSelections;
            
            if (level4) {
                currentIndustryCode = level4;
                // 查找行业名称
                const level1Item = jsonData.find(item => item.code === level1);
                if (level1Item && level1Item.children) {
                    const level2Item = level1Item.children.find(item => item.code === level2);
                    if (level2Item && level2Item.children) {
                        const level3Item = level2Item.children.find(item => item.code === level3);
                        if (level3Item && level3Item.children) {
                            const level4Item = level3Item.children.find(item => item.code === level4);
                            if (level4Item) {
                                currentIndustryName = level4Item.name;
                            }
                        }
                    }
                }
                document.getElementById('step1-next').disabled = false;
            } else {
                currentIndustryCode = null;
                currentIndustryName = null;
                document.getElementById('step1-next').disabled = true;
            }
            
            // 重置行业代码输入框
            document.getElementById('industryCode').value = '';
            document.getElementById('codeValidation').innerHTML = '';
        }

        // 验证行业代码
        function validateIndustryCode() {
            const inputCode = document.getElementById('industryCode').value;
            const validationDiv = document.getElementById('codeValidation');
            
            // 检查是否为4位数字
            if (inputCode.length !== 4 || !/^\d+$/.test(inputCode)) {
                validationDiv.innerHTML = '请输入有效的4位数字行业代码';
                validationDiv.className = 'validation-message invalid';
                document.getElementById('step1-next').disabled = true;
                return;
            }
            
            // 检查代码是否存在
            let found = false;
            let industryName = '';
            
            // 遍历所有行业代码
            for (let level1 of jsonData) {
                if (level1.children) {
                    for (let level2 of level1.children) {
                        if (level2.children) {
                            for (let level3 of level2.children) {
                                if (level3.children) {
                                    for (let level4 of level3.children) {
                                        if (level4.code === inputCode) {
                                            found = true;
                                            industryName = level4.name;
                                            break;
                                        }
                                    }
                                }
                                if (found) break;
                            }
                        }
                        if (found) break;
                    }
                }
                if (found) break;
            }
            
            if (found) {
                validationDiv.innerHTML = '行业代码有效：' + inputCode + ' ' + industryName;
                validationDiv.className = 'validation-message valid';
                currentIndustryCode = inputCode;
                currentIndustryName = industryName;
                document.getElementById('step1-next').disabled = false;
                
                // 重置下拉框选择
                document.getElementById('level1').value = '';
                document.getElementById('level2').value = '';
                document.getElementById('level3').value = '';
                document.getElementById('level4').value = '';
                currentSelections.level1 = null;
                currentSelections.level2 = null;
                currentSelections.level3 = null;
                currentSelections.level4 = null;
            } else {
                validationDiv.innerHTML = '无效的行业代码，请重新输入';
                validationDiv.className = 'validation-message invalid';
                currentIndustryCode = null;
                currentIndustryName = null;
                document.getElementById('step1-next').disabled = true;
            }
        }

        // 步骤导航：进入第二步
        function proceedToStep2() {
            if (!currentIndustryCode) return;
            
            // 更新步骤指示器
            document.getElementById('step1-indicator').className = 'step completed';
            document.getElementById('step2-indicator').className = 'step active';
            
            // 切换步骤内容
            document.getElementById('step1').className = 'wizard-step';
            document.getElementById('step2').className = 'wizard-step active';
            
            // 执行匹配逻辑
            matchGreenFinanceProjects();
        }

        // 步骤导航：返回第一步
        function backToStep1() {
            // 更新步骤指示器
            document.getElementById('step2-indicator').className = 'step';
            document.getElementById('step1-indicator').className = 'step active';
            
            // 切换步骤内容
            document.getElementById('step2').className = 'wizard-step';
            document.getElementById('step1').className = 'wizard-step active';
            
            // 重置第二步的状态
            document.getElementById('step2-next').disabled = true;
        }

        // 步骤导航：进入第三步
        function proceedToStep3() {
            if (!selectedCategory) return;
            
            // 更新步骤指示器
            document.getElementById('step2-indicator').className = 'step completed';
            document.getElementById('step3-indicator').className = 'step active';
            
            // 切换步骤内容
            document.getElementById('step2').className = 'wizard-step';
            document.getElementById('step3').className = 'wizard-step active';
            
            // 显示选中的分类信息
            showSelectedCategoryInfo();
        }

        // 步骤导航：返回第二步
        function backToStep2() {
            // 更新步骤指示器
            document.getElementById('step3-indicator').className = 'step';
            document.getElementById('step2-indicator').className = 'step active';
            
            // 切换步骤内容
            document.getElementById('step3').className = 'wizard-step';
            document.getElementById('step2').className = 'wizard-step active';
        }

        // 匹配绿色金融支持项目
        function matchGreenFinanceProjects() {
            const resultDiv = document.getElementById('matching-result');
            resultDiv.innerHTML = '<p>正在匹配，请稍候...</p>';
            
            // 清空之前的匹配结果
            matchedItems = [];
            
            // 遍历greenFinanceData进行匹配
            for (let category of greenFinanceData) {
                if (category.children) {
                    for (let item of category.children) {
                        // 检查B字段是否精确匹配
                        if (item.B === currentIndustryCode) {
                            matchedItems.push({
                                category_id: category.category_id,
                                category_name: category.category_name,
                                B: item.B,
                                C: item.C,
                                D: item.D,
                                E: item.E,
                                F: item.F
                            });
                        } else if (item.E) {
                            // 检查E字段是否包含行业代码
                            if (item.E.includes(currentIndustryCode)) {
                                matchedItems.push({
                                    category_id: category.category_id,
                                    category_name: category.category_name,
                                    B: item.B,
                                    C: item.C,
                                    D: item.D,
                                    E: item.E,
                                    F: item.F
                                });
                            }
                        }
                    }
                }
            }
            
            // 显示匹配结果
            displayMatchingResults();
        }

        // 显示匹配结果
        function displayMatchingResults() {
            const resultDiv = document.getElementById('matching-result');
            
            if (matchedItems.length === 0) {
                // 没有匹配项
                resultDiv.innerHTML = `
                    <div class="final-result">
                        <h3>匹配结果</h3>
                        <div class="status not-eligible">
                            该行业代码未匹配到任何绿色金融支持项目
                        </div>
                        <p>您的项目可能不符合绿色金融支持项目的条件</p>
                    </div>
                `;
                document.getElementById('step2-next').disabled = true;
                document.getElementById('declare-not-eligible').style.display = 'none';
            } else {
                // 有匹配项，显示表格
                let tableHTML = `
                    <h3>为行业代码 ${currentIndustryCode} 匹配到 ${matchedItems.length} 个绿色金融支持项目</h3>
                    <p>请选择您所属的项目类别：</p>
                    <div class="table-container">
                        <table class="result-table">
                            <thead>
                                <tr>
                                    <th>选择</th>
                                    <th>行业代码</th>
                                    <th>类别ID</th>
                                    <th>类别名称</th>
                                    <th>国民经济行业类别名称</th>
                                    <th>条件/标准</th>
                                    <th>备注</th>
                                    <th>温室气体减排贡献</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                for (let i = 0; i < matchedItems.length; i++) {
                    const item = matchedItems[i];
                    // 处理行业代码显示，如果是"0000"则显示空字符串
                    let industryCodeDisplay = item.B === "0000" ? "" : item.B;
                    // 如果行业代码与当前输入的代码匹配，则高亮显示
                    if (industryCodeDisplay && industryCodeDisplay === currentIndustryCode) {
                        industryCodeDisplay = `<span class="highlight">${industryCodeDisplay}</span>`;
                    }
                    tableHTML += `
                        <tr>
                            <td><input type="radio" name="category-select" class="select-checkbox" value="${i}" onchange="selectCategory(${i})"></td>
                            <td>${industryCodeDisplay}</td>
                            <td>${item.category_id}</td>
                            <td>${item.category_name}</td>
                            <td>${item.C}</td>
                            <td>${formatText(item.D)}</td>
                            <td>${formatText(item.E)}</td>
                            <td><span class="ghg-contribution ${getGHGClass(item.F)}">${getGHGText(item.F)}</span></td>
                        </tr>
                    `;
                }
                
                tableHTML += `
                            </tbody>
                        </table>
                    </div>
                `;
                
                resultDiv.innerHTML = tableHTML;
                document.getElementById('step2-next').disabled = true;
                document.getElementById('declare-not-eligible').style.display = 'inline-block';
            }
        }

        // 格式化文本（处理换行并高亮行业代码）
        function formatText(text) {
            if (!text) return '';
            // 替换换行符并高亮当前行业代码
            let formattedText = text.replace(/\n/g, '<br>');
            if (currentIndustryCode) {
                // 创建高亮正则表达式，匹配整个代码
                const regex = new RegExp(`(${currentIndustryCode})`, 'g');
                formattedText = formattedText.replace(regex, '<span class="highlight">$1</span>');
            }
            return formattedText;
        }

        // 获取温室气体减排贡献的样式类
        function getGHGClass(value) {
            if (value === 2) return 'high';
            if (value === 1) return 'medium';
            return 'low';
        }

        // 获取温室气体减排贡献的显示文本
        function getGHGText(value) {
            if (value === 2) return '√√（高）';
            if (value === 1) return '√（中）';
            return '无（低）';
        }

        // 选择分类
        function selectCategory(index) {
            selectedCategory = matchedItems[index];
            document.getElementById('step2-next').disabled = false;
        }

        // 声明不符合任何条件
        function declareNotEligible() {
            showFinalResult(false);
        }

        // 显示选中的分类信息
        function showSelectedCategoryInfo() {
            const infoDiv = document.getElementById('selected-category-info');
            if (selectedCategory) {
                // 处理行业代码显示，如果是"0000"则显示空字符串
                let industryCodeDisplay = selectedCategory.B === "0000" ? "" : selectedCategory.B;
                // 如果行业代码与当前输入的代码匹配，则高亮显示
                if (industryCodeDisplay && industryCodeDisplay === currentIndustryCode) {
                    industryCodeDisplay = `<span class="highlight">${industryCodeDisplay}</span>`;
                }
                infoDiv.innerHTML = `
                    <h3>您选择的项目类别</h3>
                    <div class="result">
                        <p><strong>行业代码：</strong>${industryCodeDisplay}</p>
                        <p><strong>类别ID：</strong>${selectedCategory.category_id}</p>
                        <p><strong>类别名称：</strong>${selectedCategory.category_name}</p>
                        <p><strong>国民经济行业类别名称：</strong>${selectedCategory.C}</p>
                        <p><strong>条件/标准：</strong>${formatText(selectedCategory.D)}</p>
                        <p><strong>备注：</strong>${formatText(selectedCategory.E)}</p>
                        <p><strong>温室气体减排贡献：</strong><span class="ghg-contribution ${getGHGClass(selectedCategory.F)}">${getGHGText(selectedCategory.F)}</span></p>
                    </div>
                `;
            } else {
                infoDiv.innerHTML = '<p>请选择一个匹配的项目后再上传材料</p>';
            }
        }

        // 提交审核
        function submitApplication() {
            // 检查是否上传了文件
            const fileInput = document.getElementById('proof-file');
            const description = document.getElementById('description').value;
            
            if (!fileInput.files.length && !description) {
                alert('请上传证明材料或填写说明');
                return;
            }
            
            // 显示提交结果
            showFinalResult(true);
        }

        // 显示最终结果
        function showFinalResult(eligible) {
            // 隐藏所有步骤
            document.querySelectorAll('.wizard-step').forEach(step => {
                step.className = 'wizard-step';
            });
            
            // 隐藏步骤指示器
            document.querySelector('.wizard-steps').style.display = 'none';
            
            // 显示结果页面
            const resultDiv = document.getElementById('result-page');
            resultDiv.className = 'wizard-step active';
            
            const finalResultDiv = document.getElementById('final-result');
            
            if (eligible) {
                finalResultDiv.innerHTML = `
                    <h3>申请提交成功</h3>
                    <div class="status pending">
                        等待管理员审核
                    </div>
                    <p>您的申请已提交，管理员将在3-5个工作日内进行审核</p>
                    <p>审核结果将通过邮件通知您，请耐心等待</p>
                `;
            } else {
                finalResultDiv.innerHTML = `
                    <h3>申请结果</h3>
                    <div class="status not-eligible">
                        该项目不符合绿色金融支持项目条件
                    </div>
                    <p>感谢您的查询，您的项目目前不符合绿色金融支持项目的条件</p>
                    <p>请关注最新的绿色金融政策，或咨询相关部门了解更多信息</p>
                `;
            }
        }
        
        </script>
</body>
</html>